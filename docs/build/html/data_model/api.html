

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5. External API &mdash; OmniSciDB  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Data Types" href="types.html" />
    <link rel="prev" title="4. Memory Layout" href="memory_layout.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OmniSciDB
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">High Level Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">1. OmniSciDB at 30,000 feet</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Model</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="catalog/index.html">1. Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="columnar_layout.html">2. Columnar Data Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="physical_layout.html">3. Physical Data Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory_layout.html">4. Memory  Layout</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. External API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#design">5.1. Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#protocols">5.2. Protocols</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="types.html">6. Data Types</a></li>
</ul>
<p class="caption"><span class="caption-text">Query Execution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../execution/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/flow.html">2. Data Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/parse.html">3. Parser / Planner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/optimization.html">4. Interpreter / Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/scheduler.html">5. Scheduler / DAG Executor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/codegen.html">6. Code Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/kernels.html">7. Execution Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/results.html">8. Query Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/workflows.html">9. Example Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../components/logger.html">1. Logger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/query_state.html">2. QueryState</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OmniSciDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>5. External API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/data_model/api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="external-api">
<h1>5. External API<a class="headerlink" href="#external-api" title="Permalink to this headline">¶</a></h1>
<p>OmniSciDB uses Apache’s Thrift software framework for all external client communication.  The open source clients shipped with the repository include OmniSci’s <cite>omnisql</cite> command line process, JDBC driver and SQLImporter utility.  For a full list of Thrift enabled clients supported by OmniSci see Table <a class="reference internal" href="#omnisci-open-source-clients"><span class="std std-ref">OmniSci Open Source Clients</span></a> below. The full list of thrift API methods can be found in the <cite>mapd.thrift</cite> file in the root of the OmniSciDB source directory.</p>
<p>All internal communication between the discrete processes within OmniSciDB also use the Thrift communication framework.  For example, communications between OmniSciDB and Apache Calcite are facilitated via Thrift.</p>
<div class="section" id="design">
<h2>5.1. Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<p>OmniSci has developed a rich set of Thrift based API calls.  The bindings for the these calls can be found in the file <cite>mapd.thrift</cite> in the open source repository.</p>
<p>The classes generated from the Thrift bindings include <cite>MapDProcessor</cite>, <cite>MapDClient</cite> and <cite>MapDIf</cite>. The OmniSci code sitting ‘behind’ these classes can be found in the class <cite>MapDHandler</cite>, in the file <cite>ThriftHandler/MapDhandler.(cpp/h)</cite>.</p>
<p>The class OmniSci class <cite>MapDHander</cite> implements the generated interface <cite>MapDIf</cite>.  The OmniSci server (in <cite>MapDServer.cpp</cite>) create an instance of <cite>MapDHandler</cite>, using this object to initialize two instances of <cite>apache::ThreadedServer</cite> objects - one per Thrift protocol supported by the server (see section below for protocol details).</p>
<p>OmniSci clients such as the JDBC driver use the generated MapDClient class to make calls through to the server.  To maintain state across client calls to the  Thrift bindings, an initial connection/validation process returns a session identifier as a <cite>TSessionId</cite> to the connecting client; subsequent calls need to include the session identifier as part of the serialised data structure.</p>
<p>In the case of Thrift communication with the <cite>Calcite</cite> serve, Calcite acts as the communication server and the database acts as the client.  The <cite>Calcite</cite> Thrift bindings can be found in <cite>java/thrift/calciteserver.thrift</cite> in the repository. The <cite>MapDHandler</cite> class (called from <cite>MapdServer.cpp</cite>) creates an instance of the Calcite class, a class generated by Thrift from the <cite>calciteserver.thrift</cite> binding which implements the client portion of the framework.  The Java Calcite server creates an apache::TThreadPoolServer to handle API calls.  The OmniSci code written to process the API calls can be found in the file <cite>CalciteServerHandler.java</cite> under <cite>java/calcite</cite> in the repository.</p>
</div>
<div class="section" id="protocols">
<h2>5.2. Protocols<a class="headerlink" href="#protocols" title="Permalink to this headline">¶</a></h2>
<p>The OmniSci database server presents the Thrift interface using either Thrift’s ‘binary’ or ‘json’ protocols. When using json, Thrift will wrap the payload in a either a http or https header.  For simplicity, in this document reference to http and https will be used to mean  http/json and https/json.</p>
<p>The Thrift framework offers support for SSL/TLS encryption of links between clients and servers.  OmniSci uses this feature to secure/encrypted communications between both its external clients and the main server and its internal process.  The database system can process binary encrypted connections and https connections.  To manage https communications, OmniSci provides a web_server to act as a proxy to the normal http port opened by the server.  Table <a class="reference internal" href="#omnisci-open-source-clients"><span class="std std-ref">OmniSci Open Source Clients</span></a> below lists the protocols supported by each of the clients.</p>
<p>As mentioned in the ‘Design’ section the server opens two ports, a binary port and a http port - whether or not these ports and encrypted and which specific ports number are used is configurable at startup; either through command line parameters or a configuration files. The server can not open a port for a specific protocol in both both encrypted and non-encrypted format; for example it can not open a <cite>binary</cite> port and <cite>binary encrypted</cite> port.</p>
<table class="docutils align-default" id="omnisci-open-source-clients">
<caption><span class="caption-text">OmniSci Open Source Clients</span><a class="headerlink" href="#omnisci-open-source-clients" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Client process</p></th>
<th class="head"><p>Protocols</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>JDBC Driver</p></td>
<td><p>Binary/Binary Encrypted/HTTP/HTTPS</p></td>
</tr>
<tr class="row-odd"><td><p>Omnisql</p></td>
<td><p>Binary/Binary Encrypted/HTTP/HTTPS</p></td>
</tr>
<tr class="row-even"><td><p>SQLImporter</p></td>
<td><p>Binary/HTTP/HTTPS</p></td>
</tr>
<tr class="row-odd"><td><p>KafkaImporter</p></td>
<td><p>Binary/HTTP/HTTPS</p></td>
</tr>
<tr class="row-even"><td><p>StreamInserter</p></td>
<td><p>Binary/HTTP/HTTPS</p></td>
</tr>
<tr class="row-odd"><td><p>Pymapd</p></td>
<td><p>Binary/Binary Encrypted/HTTP/HTTPS</p></td>
</tr>
<tr class="row-even"><td><p>Julia</p></td>
<td><p>Binary</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="types.html" class="btn btn-neutral float-right" title="6. Data Types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="memory_layout.html" class="btn btn-neutral float-left" title="4. Memory Layout" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, OmniSci, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Catalog &mdash; OmniSciDB  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. Columnar Data Organization" href="../columnar_layout.html" />
    <link rel="prev" title="1. OmniSciDB at 30,000 feet" href="../../overview/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> OmniSciDB
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">High Level Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">1. OmniSciDB at 30,000 feet</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Model</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Catalog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#high-level-overview">1.1. High Level Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-catalog-global">1.2. System Catalog (Global)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#users">1.2.1. Users</a></li>
<li class="toctree-l3"><a class="reference internal" href="#roles">1.2.2. Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#databases">1.2.3. Databases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#permissions">1.2.4. Permissions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#catalog-database-specific">1.3. Catalog (Database Specific)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tables">1.3.1. Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#columns">1.3.2. Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dictionaries">1.3.3. Dictionaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sharded-tables">1.3.4. Sharded Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#views">1.3.5. Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dashboards">1.3.6. Dashboards</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#migration">1.4. Migration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../columnar_layout.html">2. Columnar Data Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physical_layout.html">3. Physical Data Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../memory_layout.html">4. Memory  Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">5. External API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../types.html">6. Data Types</a></li>
</ul>
<p class="caption"><span class="caption-text">Query Execution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../execution/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/flow.html">2. Data Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/parse.html">3. Parser / Planner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/optimization.html">4. Interpreter / Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/scheduler.html">5. Scheduler / DAG Executor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/codegen.html">6. Code Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/kernels.html">7. Execution Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/results.html">8. Query Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../execution/workflows.html">9. Example Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../components/logger.html">1. Logger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../components/query_state.html">2. QueryState</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OmniSciDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>1. Catalog</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/data_model/catalog/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="catalog">
<h1>1. Catalog<a class="headerlink" href="#catalog" title="Permalink to this headline">¶</a></h1>
<div class="section" id="high-level-overview">
<h2>1.1. High Level Overview<a class="headerlink" href="#high-level-overview" title="Permalink to this headline">¶</a></h2>
<p>OmniSciDB stores database, table, and user information in a centralized <cite>Catalog</cite>. Each database has its own <cite>Catalog</cite>, with the top-level <em>System Catalog</em> (<cite>SysCatalog</cite>) managing catalogs across databases. Each catalog (including the system catalog) is backed by a <cite>SQLite</cite> database in the <cite>mapd_catalogs</cite> directory (a top-level directory in the OmniSciDB data directory). In addition to managing catalogs for individual databases, the <cite>SysCatalog</cite> manages users, roles, and higher-level object permissions.</p>
<p>Both SysCatalog and Catalog classes are defined in files of the same name in the <cite>Catalog</cite> source directory. All catalog-related code lives inside the <code class="docutils literal notranslate"><span class="pre">Catalog_Namespace</span></code>.</p>
<img alt="../../_images/catalog_overview.png" src="../../_images/catalog_overview.png" />
</div>
<div class="section" id="system-catalog-global">
<h2>1.2. System Catalog (Global)<a class="headerlink" href="#system-catalog-global" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">SysCatalog</span></code> is a singleton class responsible for managing top-level OmniSciDB server metadata, including:</p>
<ul class="simple">
<li><p>Users</p></li>
<li><p>Roles</p></li>
<li><p>Databases</p></li>
<li><p>Permissions</p></li>
</ul>
<p>Data is persisted using a <em>SQLite</em> database at <cite>&lt;path_to_db/mapd_catalogs/omnisci_system_catalog&gt;</cite>. When the <cite>SysCatalog</cite> is created, the contents of the SQLite database is read and stored in memory. Subsequent reads only reference in-memory data structures. All writes are immediately flushed to SQLite.</p>
<p>Below is a UML representation of the schema of the SQLite database backing the system catalog:</p>
<a class="reference internal image-reference" href="../../_images/syscat_schema.png"><img alt="../../_images/syscat_schema.png" src="../../_images/syscat_schema.png" style="height: 400px;" /></a>
<div class="section" id="users">
<h3>1.2.1. Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h3>
<p>User accounts in OmniSciDB are global (that is, one user account can have access to multiple databases). The users login information is stored in the <code class="docutils literal notranslate"><span class="pre">mapd_users</span></code> system catalog table. When a user is authenticated, a <code class="docutils literal notranslate"><span class="pre">UserMetadata</span></code> struct is created to provide an in-memory representation of the user.</p>
</div>
<div class="section" id="roles">
<h3>1.2.2. Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h3>
<p>Roles are used to grant permissions to groups of users. Roles are stored in the <code class="docutils literal notranslate"><span class="pre">mapd_roles</span></code> table. Each user also has a role corresponding to the name of the user, e.g. adding a user <cite>Max</cite> will also add a corresponding role called <cite>Max</cite> automatically.</p>
</div>
<div class="section" id="databases">
<h3>1.2.3. Databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">mapd_databases</span></code> table functions as a lookup table for mapping a database name (a string) to the internal database identifier (an integer).</p>
</div>
<div class="section" id="permissions">
<h3>1.2.4. Permissions<a class="headerlink" href="#permissions" title="Permalink to this headline">¶</a></h3>
<p>All system-level object privilege grants are stored and accessed from the <code class="docutils literal notranslate"><span class="pre">mapd_object_permissions</span></code> table. An object permission can be assigned to a role, and specifies what level of access a role has to various parts of the system. See <a class="reference external" href="https://docs.omnisci.com/latest/5_roles.html#ddl-roles-and-privileges">DB Object Privileges</a> for more information about interfacing with OmniSciDB’s security model.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">granteeMap_</span></code> in the <code class="docutils literal notranslate"><span class="pre">SysCatalog</span></code> class stores <code class="docutils literal notranslate"><span class="pre">Grantee</span></code> objects, representing object level permissions grants. The <code class="docutils literal notranslate"><span class="pre">granteeMap_</span></code> is built at startup.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">objectDescriptorMap_</span></code> in the <code class="docutils literal notranslate"><span class="pre">SysCatalog</span></code> class stores <code class="docutils literal notranslate"><span class="pre">ObjectRoleDescriptor``s,</span> <span class="pre">relating</span> <span class="pre">a</span> <span class="pre">role</span> <span class="pre">to</span> <span class="pre">a</span> <span class="pre">specific</span> <span class="pre">privilege</span> <span class="pre">grant.</span> <span class="pre">The</span>&#160; <span class="pre">``objectDescriptorMap_</span></code> is also built when  Together, the <code class="docutils literal notranslate"><span class="pre">granteeMap_</span></code> and <code class="docutils literal notranslate"><span class="pre">objectDescriptorMap_</span></code> are referenced when determining if a user has access to perform an action in the database.</p>
</div>
</div>
<div class="section" id="catalog-database-specific">
<h2>1.3. Catalog (Database Specific)<a class="headerlink" href="#catalog-database-specific" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Catalog</span></code> is the top-level metadata object for a database. When the OmniSciDB data directory is initialized, an initial “default” database is created. By default, OmniSciDB always has at least one catalog at startup. The <code class="docutils literal notranslate"><span class="pre">Catalog</span></code> maintains the following objects:</p>
<ul class="simple">
<li><p>Tables</p></li>
<li><p>Columns</p></li>
<li><p>Views</p></li>
<li><p>Dashboards</p></li>
<li><p>mapd_dictionaries</p></li>
</ul>
<p>Data is persisted using a <em>SQLite</em> database per catalog in the <cite>mapd_catalogs</cite> directory, with the name of the <em>SQLite</em> database file corresponding to the database name. Just like the <cite>SysCatalog</cite>, a <cite>Catalog</cite> loads all data from SQLite on creation and flushes writes to SQLite immediately.</p>
<p>Below is a UML representation of the schema of the SQLite database backing a catalog:</p>
<a class="reference internal image-reference" href="../../_images/cat_schema.png"><img alt="../../_images/cat_schema.png" src="../../_images/cat_schema.png" style="height: 400px;" /></a>
<div class="section" id="tables">
<h3>1.3.1. Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h3>
<p>Tables metadata for all tables in a given database is stored in the <code class="docutils literal notranslate"><span class="pre">mapd_tables</span></code> <em>SQLite</em> table and read by the <code class="docutils literal notranslate"><span class="pre">Catalog</span></code> at startup. Table metadata is stored in a <code class="docutils literal notranslate"><span class="pre">TableDescriptor</span></code> for access by other objects in the system. For a given table, the <code class="docutils literal notranslate"><span class="pre">TableDescriptor</span></code> both holds table metadata (id, fragment size, etc) and is responsible for instantiating the <code class="docutils literal notranslate"><span class="pre">Fragmenter</span></code> for the table. That is, the <code class="docutils literal notranslate"><span class="pre">TableDescriptor</span></code> is the primary interface to locating storage for a given table.</p>
</div>
<div class="section" id="columns">
<h3>1.3.2. Columns<a class="headerlink" href="#columns" title="Permalink to this headline">¶</a></h3>
<p>Column metadata is stored in the <code class="docutils literal notranslate"><span class="pre">mapd_columns</span></code> table. Each column is uniquely identified by an ID pair, mapping to a unique table ID and a unique column ID within that table. <code class="docutils literal notranslate"><span class="pre">ColumnDescriptor</span></code> objects pass column metadata (including the <cite>SQL Type</cite> of a column) throughout the system.</p>
</div>
<div class="section" id="dictionaries">
<h3>1.3.3. Dictionaries<a class="headerlink" href="#dictionaries" title="Permalink to this headline">¶</a></h3>
<p>Columns of type <cite>dictionary encoded string</cite> require a separate string dictionary. The string dictionary metadata is stored in the <code class="docutils literal notranslate"><span class="pre">mapd_dictionaries</span></code> SQLite table. <code class="docutils literal notranslate"><span class="pre">DictDescriptor</span></code> objects encapsulate string dictionary information. Like the <code class="docutils literal notranslate"><span class="pre">TabelDescriptor</span></code>, <code class="docutils literal notranslate"><span class="pre">DictDescriptor</span></code> is the primary interface for accessing physical string dictionary storage.</p>
</div>
<div class="section" id="sharded-tables">
<h3>1.3.4. Sharded Tables<a class="headerlink" href="#sharded-tables" title="Permalink to this headline">¶</a></h3>
<p>OmniSciDB supports <cite>sharded tables</cite> – that is, a table partitioned by a predefined column (called the <cite>shard key</cite>) into a pre-determined number of <cite>physical tables</cite>, more commonly referred to as <cite>shards</cite>. Sharding is used for increasing performance (by grouping like data on like devices) and for support complex queries in distributed mode (Enterprise Edition only). Internally, a sharded table is represented as a top-level <cite>logical</cite> table and several underlying <cite>physical</cite> tables (with the number of physical tables corresponding to the total shard count). This mapping is stored in the <code class="docutils literal notranslate"><span class="pre">mapd_logical_to_physical</span></code> <em>SQLite</em> table.</p>
</div>
<div class="section" id="views">
<h3>1.3.5. Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h3>
<p>Views in OmniSciDB are currently not materialized during creation. Instead, the definition for the view is stored in the <code class="docutils literal notranslate"><span class="pre">mapd_views</span></code> <em>SQLite</em> table, and the view is materialized lazily when the view is queried. By using lazy materialization, OmniSciDB fuse the query on the view with the underlying table(s) backing the view, reducing the number of intermediate projections required and/or the amount of data that must be loaded and processed. Views are represented by a <code class="docutils literal notranslate"><span class="pre">TableDescriptor</span></code> object with the <cite>isView</cite> boolean member set to <cite>true</cite>.</p>
</div>
<div class="section" id="dashboards">
<h3>1.3.6. Dashboards<a class="headerlink" href="#dashboards" title="Permalink to this headline">¶</a></h3>
<p>OmniSciDB holds the dashboard state for OmniSci Immerse (Enterprise Edition only), our web-based data exploration tool. Dashboards are serialized and stored in the <code class="docutils literal notranslate"><span class="pre">mapd_dashboards</span></code> table. Because dashboards are built over a database and typically contain many database objects, they are considered a top-level object in the OmniSciDB catalog and object permissions model.</p>
</div>
</div>
<div class="section" id="migration">
<h2>1.4. Migration<a class="headerlink" href="#migration" title="Permalink to this headline">¶</a></h2>
<p>OmniSciDB includes a schema migration service for migrating user catalog information between versions. The schema migration service can also drive storage level migrations. The <code class="docutils literal notranslate"><span class="pre">mapd_version_history</span></code> table enables tracking whether or not a migration has been performed. When changing <cite>SysCatalog</cite> or <cite>Catalog</cite> <em>SQLite</em> schema, migrations must be used to ensure previous data directories work properly.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../columnar_layout.html" class="btn btn-neutral float-right" title="2. Columnar Data Organization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../overview/index.html" class="btn btn-neutral float-left" title="1. OmniSciDB at 30,000 feet" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, OmniSci, Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>